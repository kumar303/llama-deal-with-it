<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dancing Llama</title>
    <script src="https://unpkg.com/preact@latest/dist/preact.umd.js"></script>
    <script src="https://unpkg.com/preact@latest/hooks/dist/hooks.umd.js"></script>
    <script src="https://unpkg.com/htm@latest/dist/htm.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes dance {
        0%,
        100% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(-20px);
        }
        75% {
          transform: translateY(20px);
        }
      }

      @keyframes foot-dance {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-1px);
        }
        40% {
          transform: translateX(1px);
        }
        60% {
          transform: translateX(-1px);
        }
        80% {
          transform: translateX(1px);
        }
      }

      /* Different dance moves for other llamas */
      @keyframes spin-dance {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes spin-dance-reverse {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(-360deg);
        }
      }

      @keyframes sway-dance {
        0%,
        100% {
          transform: rotate(-5deg);
        }
        50% {
          transform: rotate(5deg);
        }
      }

      @keyframes head-bob {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-3px);
        }
      }

      @keyframes shuffle-dance {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        75% {
          transform: translateX(3px);
        }
      }

      @keyframes wiggle-dance {
        0%,
        100% {
          transform: rotate(0deg) translateY(0);
        }
        25% {
          transform: rotate(-3deg) translateY(-2px);
        }
        75% {
          transform: rotate(3deg) translateY(-2px);
        }
      }

      @keyframes fade-in-dance {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes rainbow-pulse {
        0%,
        100% {
          background-color: #ff0000;
          box-shadow: 0 0 20px #ff0000;
        }
        16% {
          background-color: #ff7f00;
          box-shadow: 0 0 20px #ff7f00;
        }
        33% {
          background-color: #ffff00;
          box-shadow: 0 0 20px #ffff00;
        }
        50% {
          background-color: #00ff00;
          box-shadow: 0 0 20px #00ff00;
        }
        66% {
          background-color: #0000ff;
          box-shadow: 0 0 20px #0000ff;
        }
        83% {
          background-color: #9400d3;
          box-shadow: 0 0 20px #9400d3;
        }
      }

      @keyframes confetti-explode {
        0% {
          transform: translate(0, 0) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        100% {
          transform: translate(var(--x-spread), var(--y-spread)) rotate(720deg);
          opacity: 1;
        }
      }

      @keyframes confetti-fall {
        0% {
          transform: translate(var(--x-spread), var(--y-spread)) rotate(720deg);
        }
        100% {
          transform: translate(
              calc(var(--x-spread) + var(--x-drift)),
              calc(var(--y-spread) + 400px)
            )
            rotate(1080deg);
          opacity: 0;
        }
      }

      @keyframes sunglasses-fly-in {
        0% {
          transform: translate(-80px, -80px) rotate(0deg) scale(2);
          opacity: 0;
        }
        10% {
          opacity: 1;
          transform: translate(-70px, -70px) rotate(180deg) scale(1.9);
        }
        20% {
          transform: translate(-60px, -60px) rotate(360deg) scale(1.8);
        }
        30% {
          transform: translate(-50px, -50px) rotate(540deg) scale(1.7);
        }
        40% {
          transform: translate(-40px, -40px) rotate(720deg) scale(1.6);
        }
        50% {
          transform: translate(-30px, -30px) rotate(900deg) scale(1.5);
        }
        60% {
          transform: translate(-20px, -20px) rotate(1080deg) scale(1.4);
        }
        70% {
          transform: translate(-10px, -10px) rotate(1260deg) scale(1.3);
        }
        80% {
          transform: translate(-5px, -5px) rotate(1440deg) scale(1.2);
        }
        90% {
          transform: translate(-2px, -2px) rotate(1620deg) scale(1.1);
        }
        100% {
          transform: translate(0, 0) rotate(1800deg) scale(1);
          opacity: 1;
        }
      }

      @keyframes disco-ball-drop {
        0% {
          transform: translateY(-200px);
          opacity: 0;
        }
        10% {
          opacity: 1;
          transform: translateY(-180px);
        }
        100% {
          transform: translateY(20px);
          opacity: 1;
        }
      }

      @keyframes sparkle {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      .dancing {
        animation: dance 0.476s ease-in-out infinite;
      }

      .dancing-feet-left {
        animation: foot-dance 1.2s ease-in-out infinite;
        animation-delay: 10s; /* Wait 10s after sunglasses land (5s + 10s) */
        animation-fill-mode: backwards;
      }

      .dancing-feet-right {
        animation: foot-dance 1.2s ease-in-out infinite;
        animation-delay: 10.6s; /* Wait 10s + offset for alternating movement */
        animation-fill-mode: backwards;
      }

      .sunglasses {
        animation: sunglasses-fly-in 5s cubic-bezier(0.68, -0.55, 0.265, 1.55)
          forwards;
        transform-origin: center;
      }

      .disco-ball {
        animation: disco-ball-drop 5s ease-in-out forwards;
      }

      .sparkle {
        animation: sparkle 1s ease-in-out infinite;
      }

      .sparkle-1 {
        animation-delay: 0s;
      }

      .sparkle-2 {
        animation-delay: 0.3s;
      }

      .sparkle-3 {
        animation-delay: 0.6s;
      }

      .sparkle-4 {
        animation-delay: 0.9s;
      }

      /* Dance move classes */
      .spin-dancing {
        animation: spin-dance 2s linear infinite;
      }

      .sway-dancing {
        animation: sway-dance 0.952s ease-in-out infinite; /* 2 beats */
      }

      .head-bobbing {
        animation: head-bob 0.476s ease-in-out infinite; /* On beat */
      }

      .shuffle-dancing {
        animation: shuffle-dance 0.952s ease-in-out infinite; /* 2 beats */
      }

      .wiggle-dancing {
        animation: wiggle-dance 0.476s ease-in-out infinite; /* On beat */
      }

      /* Dancefloor tiles */
      .dancefloor {
        background-image: linear-gradient(45deg, #f2f2f2 25%, transparent 25%),
          linear-gradient(-45deg, #f2f2f2 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, #f2f2f2 75%),
          linear-gradient(-45deg, transparent 75%, #f2f2f2 75%);
        background-size: 40px 40px;
        background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
      }

      /* Fade in background llamas after sunglasses land */
      .background-llama {
        opacity: 0;
        animation: fade-in-dance 1s ease-out forwards, var(--dance-animation);
        animation-delay: 5s, 6s; /* Fade in at 5s, start dancing at 6s */
      }

      /* Rainbow dancefloor tiles */
      .dancefloor-tile {
        position: absolute;
        width: 40px;
        height: 40px;
        opacity: 0;
      }

      .dancefloor-tile.active {
        opacity: 0.8;
        animation: rainbow-pulse 1s ease-in-out;
      }

      /* Confetti styles */
      .confetti-container {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        pointer-events: none;
        z-index: 1000;
      }

      .confetti-piece {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0;
        animation: confetti-explode 0.5s ease-out forwards,
          confetti-fall 3s ease-in forwards;
        animation-delay: 10s, 10.5s;
      }

      @keyframes glare-sweep {
        0% {
          opacity: 0;
          transform: translateX(0);
        }
        10% {
          opacity: 0.8;
          transform: translateX(0);
        }
        50% {
          opacity: 0.8;
          transform: translateX(-1px);
        }
        90% {
          opacity: 0.8;
          transform: translateX(-1px);
        }
        100% {
          opacity: 0;
          transform: translateX(-1px);
        }
      }

      .glare {
        opacity: 0;
        animation: glare-sweep 3s ease-in-out infinite;
        animation-delay: 5s; /* Start after sunglasses land */
        animation-fill-mode: both; /* Keeps opacity:0 until animation starts */
      }

      /* Pixelated effect */
      .pixelated {
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-900">
    <div id="app"></div>

    <!-- Hidden YouTube player -->
    <div id="youtube-player" style="display: none"></div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      const { h, render } = preact;
      const { useState, useEffect } = preactHooks;
      const html = htm.bind(h);

      // Mini Llama Component for background dancers
      const MiniLlama = ({
        color = "#FF8C00",
        danceStyle = "",
        danceAnimation = "",
        position = {},
      }) => {
        return html`
          <svg
            width="160"
            height="200"
            viewBox="0 -5 16 21"
            className=${`pixelated background-llama`}
            style=${{
              imageRendering: "pixelated",
              position: "absolute",
              "--dance-animation": danceAnimation,
              ...position,
            }}
          >
            <!-- Rainbow party hat for all background llamas -->
            <!-- Party hat -->
            <!-- Row 1 - tip (red) -->
            <rect x="11" y="-3" width="1" height="1" fill="#FF0000" />

            <!-- Row 2 (orange) -->
            <rect x="10" y="-2" width="3" height="1" fill="#FF7F00" />

            <!-- Row 3 (yellow) -->
            <rect x="10" y="-1" width="3" height="1" fill="#FFFF00" />

            <!-- Row 4 (green) -->
            <rect x="9" y="0" width="5" height="1" fill="#00FF00" />

            <!-- Row 5 (blue) -->
            <rect x="9" y="1" width="5" height="1" fill="#0000FF" />

            <!-- Hat pom-pom -->
            <rect x="11" y="-4" width="1" height="1" fill="#FFFFFF" />

            <!-- Llama body (same as main) -->
            <rect x="4" y="8" width="8" height="6" fill=${color} />

            <!-- Llama neck -->
            <rect x="9" y="5" width="3" height="4" fill=${color} />

            <!-- Llama head -->
            <rect x="9" y="2" width="4" height="3" fill=${color} />

            <!-- Ears -->
            <rect x="10" y="1" width="1" height="1" fill=${color} />
            <rect x="12" y="1" width="1" height="1" fill=${color} />

            <!-- Legs -->
            <rect x="5" y="14" width="2" height="2" fill=${color} />
            <rect x="9" y="14" width="2" height="2" fill=${color} />

            <!-- Eye -->
            <rect x="11" y="3" width="1" height="1" fill="#000" />

            <!-- Tail -->
            <rect x="3" y="9" width="1" height="2" fill=${color} />
          </svg>
        `;
      };

      // Unicorn Component for background dancers
      const Unicorn = ({
        color = "#FFB6C1",
        danceAnimation = "",
        position = {},
      }) => {
        return html`
          <svg
            width="160"
            height="160"
            viewBox="0 0 16 16"
            className=${`pixelated background-llama`}
            style=${{
              imageRendering: "pixelated",
              position: "absolute",
              "--dance-animation": danceAnimation,
              ...position,
            }}
          >
            <!-- Unicorn body -->
            <rect x="4" y="8" width="8" height="6" fill=${color} />

            <!-- Unicorn neck -->
            <rect x="9" y="5" width="3" height="4" fill=${color} />

            <!-- Unicorn head -->
            <rect x="9" y="2" width="4" height="3" fill=${color} />

            <!-- Horn -->
            <rect x="11" y="0" width="1" height="2" fill="#FFD700" />

            <!-- Ears -->
            <rect x="10" y="1" width="1" height="1" fill=${color} />
            <rect x="12" y="1" width="1" height="1" fill=${color} />

            <!-- Legs -->
            <rect x="5" y="14" width="2" height="2" fill=${color} />
            <rect x="9" y="14" width="2" height="2" fill=${color} />

            <!-- Eye -->
            <rect x="11" y="3" width="1" height="1" fill="#000" />

            <!-- Flowing tail -->
            <rect x="3" y="9" width="1" height="1" fill="#FFB6C1" />
            <rect x="2" y="10" width="2" height="1" fill="#FFB6C1" />
            <rect x="3" y="11" width="1" height="1" fill="#DDA0DD" />
          </svg>
        `;
      };

      // Dragon Component for background dancers
      const Dragon = ({
        color = "#228B22",
        danceAnimation = "",
        position = {},
      }) => {
        // Create a darker shade for wings
        const getDarkerShade = (hexColor) => {
          // Convert hex to RGB
          const r = parseInt(hexColor.slice(1, 3), 16);
          const g = parseInt(hexColor.slice(3, 5), 16);
          const b = parseInt(hexColor.slice(5, 7), 16);

          // Darken by 40%
          const darkR = Math.floor(r * 0.6);
          const darkG = Math.floor(g * 0.6);
          const darkB = Math.floor(b * 0.6);

          // Convert back to hex
          return `#${darkR.toString(16).padStart(2, "0")}${darkG
            .toString(16)
            .padStart(2, "0")}${darkB.toString(16).padStart(2, "0")}`;
        };

        const wingColor = getDarkerShade(color);

        return html`
          <svg
            width="160"
            height="160"
            viewBox="0 0 16 16"
            className=${`pixelated background-llama`}
            style=${{
              imageRendering: "pixelated",
              position: "absolute",
              "--dance-animation": danceAnimation,
              ...position,
            }}
          >
            <!-- Dragon body -->
            <rect x="4" y="8" width="8" height="6" fill=${color} />

            <!-- Dragon neck -->
            <rect x="9" y="5" width="3" height="4" fill=${color} />

            <!-- Dragon head -->
            <rect x="9" y="2" width="4" height="3" fill=${color} />

            <!-- Horns -->
            <rect x="9" y="1" width="1" height="1" fill="#FFD700" />
            <rect x="12" y="1" width="1" height="1" fill="#FFD700" />

            <!-- Wings on back -->
            <!-- Left wing -->
            <rect x="2" y="8" width="2" height="3" fill=${wingColor} />
            <rect x="1" y="9" width="1" height="2" fill=${wingColor} />

            <!-- Right wing -->
            <rect x="12" y="8" width="2" height="3" fill=${wingColor} />
            <rect x="14" y="9" width="1" height="2" fill=${wingColor} />

            <!-- Legs -->
            <rect x="5" y="14" width="2" height="2" fill=${color} />
            <rect x="9" y="14" width="2" height="2" fill=${color} />

            <!-- Eye -->
            <rect x="11" y="3" width="1" height="1" fill="#FF0000" />

            <!-- Spiky tail -->
            <rect x="3" y="9" width="1" height="2" fill=${color} />
            <rect x="2" y="11" width="2" height="1" fill=${color} />
            <rect x="2" y="10" width="1" height="1" fill="#FFD700" />
          </svg>
        `;
      };

      // Pixelated Disco Ball Component
      const PixelatedDiscoBall = () => {
        return html`
          <svg
            width="200"
            height="320"
            viewBox="0 0 16 32"
            className="pixelated disco-ball"
            style=${{
              imageRendering: "pixelated",
              position: "absolute",
              top: "-200px",
              left: "-10px",
            }}
          >
            <!-- Cord extending to top -->
            <rect x="7.5" y="0" width="1" height="20" fill="#333333" />

            <!-- Disco ball - spherical shape -->
            <!-- Row 1 - top -->
            <rect x="6" y="20" width="4" height="1" fill="#C0C0C0" />

            <!-- Row 2 -->
            <rect x="5" y="21" width="6" height="1" fill="#C0C0C0" />

            <!-- Row 3 -->
            <rect x="4" y="22" width="8" height="1" fill="#C0C0C0" />

            <!-- Row 4 -->
            <rect x="3" y="23" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 5 -->
            <rect x="3" y="24" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 6 - widest part -->
            <rect x="2" y="25" width="12" height="1" fill="#C0C0C0" />

            <!-- Row 7 - widest part -->
            <rect x="2" y="26" width="12" height="1" fill="#C0C0C0" />

            <!-- Row 8 -->
            <rect x="3" y="27" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 9 -->
            <rect x="3" y="28" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 10 -->
            <rect x="4" y="29" width="8" height="1" fill="#C0C0C0" />

            <!-- Row 11 -->
            <rect x="5" y="30" width="6" height="1" fill="#C0C0C0" />

            <!-- Row 12 - bottom -->
            <rect x="6" y="31" width="4" height="1" fill="#C0C0C0" />

            <!-- Mirror tiles pattern for spherical effect -->
            <!-- Row 1 tiles -->
            <rect x="7" y="20" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="20" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 2 tiles -->
            <rect x="6" y="21" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="21" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="21" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 3 tiles -->
            <rect x="5" y="22" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="22" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="22" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="22" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 4 tiles -->
            <rect x="4" y="23" width="1" height="1" fill="#E0E0E0" />
            <rect x="6" y="23" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="23" width="1" height="1" fill="#E0E0E0" />
            <rect x="10" y="23" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="23" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 5 tiles -->
            <rect x="4" y="24" width="1" height="1" fill="#FFFFFF" />
            <rect x="5" y="24" width="1" height="1" fill="#E0E0E0" />
            <rect x="7" y="24" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="24" width="1" height="1" fill="#E0E0E0" />
            <rect x="11" y="24" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 6 tiles (widest) -->
            <rect x="3" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="4" y="25" width="1" height="1" fill="#FFFFFF" />
            <rect x="6" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="25" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="12" y="25" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 7 tiles (widest) -->
            <rect x="2" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="3" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="5" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="13" y="26" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 8 tiles -->
            <rect x="4" y="27" width="1" height="1" fill="#FFFFFF" />
            <rect x="5" y="27" width="1" height="1" fill="#E0E0E0" />
            <rect x="7" y="27" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="27" width="1" height="1" fill="#E0E0E0" />
            <rect x="11" y="27" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 9 tiles -->
            <rect x="4" y="28" width="1" height="1" fill="#E0E0E0" />
            <rect x="6" y="28" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="28" width="1" height="1" fill="#E0E0E0" />
            <rect x="10" y="28" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="28" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 10 tiles -->
            <rect x="5" y="29" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="29" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="29" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="29" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 11 tiles -->
            <rect x="6" y="30" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="30" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="30" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 12 tiles -->
            <rect x="7" y="31" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="31" width="1" height="1" fill="#E0E0E0" />

            <!-- Sparkles around the ball -->
            <g className="sparkle sparkle-1">
              <rect x="0" y="24" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-2">
              <rect x="15" y="25" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-3">
              <rect x="1" y="30" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-4">
              <rect x="14" y="28" width="1" height="1" fill="#FFFF00" />
            </g>
          </svg>
        `;
      };

      // Pixelated Llama SVG Component
      const PixelatedLlama = ({ isDancing }) => {
        return html`
          <svg
            width="160"
            height="160"
            viewBox="0 0 16 16"
            className=${`pixelated ${isDancing ? "dancing" : ""}`}
            style=${{ imageRendering: "pixelated", overflow: "visible" }}
          >
            <!-- Llama body -->
            <rect x="4" y="8" width="8" height="6" fill="#FF8C00" />

            <!-- Llama neck -->
            <rect x="9" y="5" width="3" height="4" fill="#FF8C00" />

            <!-- Llama head -->
            <rect x="9" y="2" width="4" height="3" fill="#FF8C00" />

            <!-- Ears -->
            <rect x="10" y="1" width="1" height="1" fill="#FF8C00" />
            <rect x="12" y="1" width="1" height="1" fill="#FF8C00" />

            <!-- Legs -->
            <rect
              x="5"
              y="14"
              width="2"
              height="2"
              fill="#FF8C00"
              class=${isDancing ? "dancing-feet-left" : ""}
            />
            <rect
              x="9"
              y="14"
              width="2"
              height="2"
              fill="#FF8C00"
              class=${isDancing ? "dancing-feet-right" : ""}
            />

            <!-- Eye -->
            <rect x="11" y="3" width="1" height="1" fill="#000" />

            <!-- Tail -->
            <rect x="3" y="9" width="1" height="2" fill="#FF8C00" />

            <!-- Deal with it sunglasses -->
            ${isDancing &&
            html`
              <g className="sunglasses">
                <!-- Sunglasses frame (thicker, more pixelated) -->
                <rect x="9" y="3" width="5" height="1" fill="#000" />
                <!-- Bridge -->
                <rect x="11" y="2" width="1" height="1" fill="#000" />
                <!-- Left lens frame -->
                <rect x="9" y="2" width="2" height="1" fill="#000" />
                <rect x="9" y="4" width="2" height="1" fill="#000" />
                <rect x="8" y="3" width="1" height="1" fill="#000" />
                <!-- Right lens frame -->
                <rect x="12" y="2" width="2" height="1" fill="#000" />
                <rect x="12" y="4" width="2" height="1" fill="#000" />
                <rect x="14" y="3" width="1" height="1" fill="#000" />
                <!-- Left lens (black) -->
                <rect x="9" y="3" width="2" height="1" fill="#000" />
                <!-- Right lens (black) -->
                <rect x="12" y="3" width="2" height="1" fill="#000" />

                <!-- Pixelated glare effect - stays within lens boundaries -->
                <g className="glare">
                  <!-- Glare pixels that move across the lenses -->
                  <!-- Right lens glare (x:12-13, y:3) -->
                  <rect
                    x="13"
                    y="3"
                    width="1"
                    height="1"
                    fill="#666"
                    opacity="0.8"
                  />
                  <!-- Left lens glare (x:9-10, y:3) -->
                  <rect
                    x="10"
                    y="3"
                    width="1"
                    height="1"
                    fill="#666"
                    opacity="0.8"
                  />
                </g>
              </g>
            `}
          </svg>
        `;
      };

      // YouTube player variable
      let player;
      let playerReady = false;

      // This function will be called by YouTube API when it's ready
      window.onYouTubeIframeAPIReady = function () {
        player = new YT.Player("youtube-player", {
          height: "1",
          width: "1",
          videoId: "eklqLkyoJWA",
          playerVars: {
            autoplay: 0,
            controls: 0,
            disablekb: 1,
            fs: 0,
            loop: 1,
            playlist: "eklqLkyoJWA", // Required for loop to work
            modestbranding: 1,
            playsinline: 1,
          },
          events: {
            onReady: function (event) {
              playerReady = true;
              event.target.setVolume(50);
            },
            onStateChange: function (event) {
              // Restart video when it ends (backup for loop)
              if (event.data === YT.PlayerState.ENDED) {
                player.playVideo();
              }
            },
          },
        });
      };

      // Dancefloor Tiles Component
      const DancefloorTiles = ({ isDancing }) => {
        const [activeTiles, setActiveTiles] = useState(new Set());

        // Create a grid of tile positions
        const tilePositions = [];
        for (let x = 0; x < window.innerWidth; x += 40) {
          for (let y = 0; y < window.innerHeight; y += 40) {
            tilePositions.push({ x, y, id: `${x}-${y}` });
          }
        }

        // Randomly activate tiles when dancing
        useEffect(() => {
          if (!isDancing) {
            setActiveTiles(new Set());
            return;
          }

          const interval = setInterval(() => {
            setActiveTiles((prev) => {
              const newActive = new Set(prev);

              // Remove some random active tiles
              const activeArray = Array.from(newActive);
              for (let i = 0; i < 3; i++) {
                if (activeArray.length > 0) {
                  const randomIndex = Math.floor(
                    Math.random() * activeArray.length
                  );
                  newActive.delete(activeArray[randomIndex]);
                }
              }

              // Add some new random tiles
              for (let i = 0; i < 5; i++) {
                const randomTile =
                  tilePositions[
                    Math.floor(Math.random() * tilePositions.length)
                  ];
                newActive.add(randomTile.id);
              }

              return newActive;
            });
          }, 200);

          return () => clearInterval(interval);
        }, [isDancing]);

        return html`
          ${tilePositions.map(
            (tile) => html`
              <div
                key=${tile.id}
                className=${`dancefloor-tile ${
                  activeTiles.has(tile.id) ? "active" : ""
                }`}
                style=${{ left: `${tile.x}px`, top: `${tile.y}px` }}
              />
            `
          )}
        `;
      };

      // Confetti Component
      const Confetti = ({ isDancing }) => {
        if (!isDancing) return null;

        // Generate confetti pieces
        const confettiPieces = [];
        const colors = [
          "#FF0000",
          "#FF7F00",
          "#FFFF00",
          "#00FF00",
          "#0000FF",
          "#9400D3",
          "#FF69B4",
          "#00CED1",
        ];

        for (let i = 0; i < 100; i++) {
          // Random explosion spread
          const angle = (Math.PI * 2 * i) / 100;
          const velocity = 100 + Math.random() * 200;
          const xSpread = Math.cos(angle) * velocity;
          const ySpread = Math.sin(angle) * velocity - 100; // Bias upward

          // Random drift while falling
          const xDrift = (Math.random() - 0.5) * 100;

          // Random color
          const color = colors[Math.floor(Math.random() * colors.length)];

          confettiPieces.push({
            id: i,
            color,
            xSpread: `${xSpread}px`,
            ySpread: `${ySpread}px`,
            xDrift: `${xDrift}px`,
            delay: Math.random() * 0.2, // Slight random delay for explosion
          });
        }

        return html`
          <div className="confetti-container">
            ${confettiPieces.map(
              (piece) => html`
                <div
                  key=${piece.id}
                  className="confetti-piece"
                  style=${{
                    backgroundColor: piece.color,
                    "--x-spread": piece.xSpread,
                    "--y-spread": piece.ySpread,
                    "--x-drift": piece.xDrift,
                    animationDelay: `${10 + piece.delay}s, ${
                      10.5 + piece.delay
                    }s`,
                  }}
                />
              `
            )}
          </div>
        `;
      };

      const App = () => {
        const [isDancing, setIsDancing] = useState(false);

        const handleDanceClick = () => {
          setIsDancing(!isDancing);

          // Control YouTube player based on dancing state
          if (!isDancing && playerReady && player) {
            player.playVideo();
          } else if (playerReady && player) {
            player.pauseVideo();
          }
        };

        const backgroundDancers = [
          {
            type: "llama",
            color: "#FF69B4",
            danceAnimation: "spin-dance 2s linear infinite",
            position: { top: "20px", left: "20px" },
          },
          {
            type: "unicorn",
            color: "#DDA0DD",
            danceAnimation: "sway-dance 0.952s ease-in-out infinite",
            position: { top: "20px", right: "20px" },
          },
          {
            type: "dragon",
            color: "#228B22",
            danceAnimation: "head-bob 0.476s ease-in-out infinite",
            position: { top: "80px", left: "150px" },
          },
          {
            type: "llama",
            color: "#7B68EE",
            danceAnimation: "shuffle-dance 0.952s ease-in-out infinite",
            position: { top: "80px", right: "150px" },
          },
          {
            type: "unicorn",
            color: "#FFB6C1",
            danceAnimation: "wiggle-dance 0.476s ease-in-out infinite",
            position: { bottom: "150px", left: "20px" },
          },
          {
            type: "dragon",
            color: "#8B0000",
            danceAnimation: "sway-dance 0.952s ease-in-out infinite",
            position: { bottom: "150px", right: "20px" },
          },
          {
            type: "llama",
            color: "#FF1493",
            danceAnimation: "spin-dance-reverse 3s linear infinite",
            position: { top: "200px", left: "80px" },
          },
          {
            type: "unicorn",
            color: "#E6E6FA",
            danceAnimation: "head-bob 0.476s ease-in-out infinite",
            position: { top: "200px", right: "80px" },
          },
          {
            type: "dragon",
            color: "#4B0082",
            danceAnimation: "shuffle-dance 0.952s ease-in-out infinite",
            position: { bottom: "50px", left: "120px" },
          },
          {
            type: "llama",
            color: "#FF4500",
            danceAnimation: "wiggle-dance 0.476s ease-in-out infinite",
            position: { bottom: "50px", right: "120px" },
          },
        ];

        return html`
          <div
            className="min-h-screen w-full bg-gray-900 flex items-center justify-center relative overflow-hidden"
          >
            <!-- Dancefloor -->
            <div className="absolute inset-0 dancefloor opacity-20"></div>

            <!-- Rainbow blinking tiles -->
            <${DancefloorTiles} isDancing=${isDancing} />

            <!-- Confetti explosion -->
            <${Confetti} isDancing=${isDancing} />

            <!-- Background dancing creatures -->
            ${isDancing &&
            backgroundDancers.map((dancer) => {
              const Component =
                dancer.type === "unicorn"
                  ? Unicorn
                  : dancer.type === "dragon"
                  ? Dragon
                  : MiniLlama;
              return html` <${Component} ...${dancer} /> `;
            })}

            <!-- Main stage -->
            <div
              className="w-96 h-96 bg-gradient-to-br from-purple-900 to-pink-500 rounded-lg flex flex-col items-center justify-center shadow-2xl overflow-visible relative z-10"
            >
              ${isDancing && html`<${PixelatedDiscoBall} />`}
              <${PixelatedLlama} isDancing=${isDancing} />
              <button
                onClick=${handleDanceClick}
                className="mt-8 px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-md transition-colors duration-200 shadow-lg"
              >
                ${isDancing ? "OK, stop" : "Deal with it"}
              </button>
            </div>
          </div>
        `;
      };

      render(html`<${App} />`, document.getElementById("app"));
    </script>
  </body>
</html>
