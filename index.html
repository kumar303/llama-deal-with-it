<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dancing Llama</title>
    <script src="https://unpkg.com/preact@latest/dist/preact.umd.js"></script>
    <script src="https://unpkg.com/preact@latest/hooks/dist/hooks.umd.js"></script>
    <script src="https://unpkg.com/htm@latest/dist/htm.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes dance {
        0%,
        100% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(-20px);
        }
        75% {
          transform: translateY(20px);
        }
      }

      @keyframes foot-dance {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-1px);
        }
        40% {
          transform: translateX(1px);
        }
        60% {
          transform: translateX(-1px);
        }
        80% {
          transform: translateX(1px);
        }
      }

      @keyframes sunglasses-fly-in {
        0% {
          transform: translate(-80px, -80px) rotate(0deg) scale(2);
          opacity: 0;
        }
        10% {
          opacity: 1;
          transform: translate(-70px, -70px) rotate(180deg) scale(1.9);
        }
        20% {
          transform: translate(-60px, -60px) rotate(360deg) scale(1.8);
        }
        30% {
          transform: translate(-50px, -50px) rotate(540deg) scale(1.7);
        }
        40% {
          transform: translate(-40px, -40px) rotate(720deg) scale(1.6);
        }
        50% {
          transform: translate(-30px, -30px) rotate(900deg) scale(1.5);
        }
        60% {
          transform: translate(-20px, -20px) rotate(1080deg) scale(1.4);
        }
        70% {
          transform: translate(-10px, -10px) rotate(1260deg) scale(1.3);
        }
        80% {
          transform: translate(-5px, -5px) rotate(1440deg) scale(1.2);
        }
        90% {
          transform: translate(-2px, -2px) rotate(1620deg) scale(1.1);
        }
        100% {
          transform: translate(0, 0) rotate(1800deg) scale(1);
          opacity: 1;
        }
      }

      @keyframes disco-ball-drop {
        0% {
          transform: translateY(-200px);
          opacity: 0;
        }
        10% {
          opacity: 1;
          transform: translateY(-180px);
        }
        100% {
          transform: translateY(20px);
          opacity: 1;
        }
      }

      @keyframes sparkle {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      .dancing {
        animation: dance 0.5s ease-in-out infinite;
      }

      .dancing-feet-left {
        animation: foot-dance 1.2s ease-in-out infinite;
        animation-delay: 10s; /* Wait 10s after sunglasses land (5s + 10s) */
        animation-fill-mode: backwards;
      }

      .dancing-feet-right {
        animation: foot-dance 0.8s ease-in-out infinite;
        animation-delay: 15.4s; /* Wait 10s after sunglasses + offset for alternating movement */
        animation-fill-mode: backwards;
      }

      .sunglasses {
        animation: sunglasses-fly-in 5s cubic-bezier(0.68, -0.55, 0.265, 1.55)
          forwards;
        transform-origin: center;
      }

      .disco-ball {
        animation: disco-ball-drop 5s ease-in-out forwards;
      }

      .sparkle {
        animation: sparkle 1s ease-in-out infinite;
      }

      .sparkle-1 {
        animation-delay: 0s;
      }

      .sparkle-2 {
        animation-delay: 0.3s;
      }

      .sparkle-3 {
        animation-delay: 0.6s;
      }

      .sparkle-4 {
        animation-delay: 0.9s;
      }

      @keyframes glare-sweep {
        0% {
          opacity: 0;
          transform: translateX(0);
        }
        10% {
          opacity: 0.8;
          transform: translateX(0);
        }
        50% {
          opacity: 0.8;
          transform: translateX(-1px);
        }
        90% {
          opacity: 0.8;
          transform: translateX(-1px);
        }
        100% {
          opacity: 0;
          transform: translateX(-1px);
        }
      }

      .glare {
        opacity: 0;
        animation: glare-sweep 3s ease-in-out infinite;
        animation-delay: 5s; /* Start after sunglasses land */
        animation-fill-mode: both; /* Keeps opacity:0 until animation starts */
      }

      /* Pixelated effect */
      .pixelated {
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-100 flex items-center justify-center">
    <div id="app"></div>

    <!-- Hidden YouTube player -->
    <div id="youtube-player" style="display: none"></div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      const { h, render } = preact;
      const { useState } = preactHooks;
      const html = htm.bind(h);

      // Pixelated Disco Ball Component
      const PixelatedDiscoBall = () => {
        return html`
          <svg
            width="200"
            height="320"
            viewBox="0 0 16 32"
            className="pixelated disco-ball"
            style=${{
              imageRendering: "pixelated",
              position: "absolute",
              top: "-200px",
              left: "-10px",
            }}
          >
            <!-- Cord extending to top -->
            <rect x="7.5" y="0" width="1" height="20" fill="#333333" />

            <!-- Disco ball - spherical shape -->
            <!-- Row 1 - top -->
            <rect x="6" y="20" width="4" height="1" fill="#C0C0C0" />

            <!-- Row 2 -->
            <rect x="5" y="21" width="6" height="1" fill="#C0C0C0" />

            <!-- Row 3 -->
            <rect x="4" y="22" width="8" height="1" fill="#C0C0C0" />

            <!-- Row 4 -->
            <rect x="3" y="23" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 5 -->
            <rect x="3" y="24" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 6 - widest part -->
            <rect x="2" y="25" width="12" height="1" fill="#C0C0C0" />

            <!-- Row 7 - widest part -->
            <rect x="2" y="26" width="12" height="1" fill="#C0C0C0" />

            <!-- Row 8 -->
            <rect x="3" y="27" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 9 -->
            <rect x="3" y="28" width="10" height="1" fill="#C0C0C0" />

            <!-- Row 10 -->
            <rect x="4" y="29" width="8" height="1" fill="#C0C0C0" />

            <!-- Row 11 -->
            <rect x="5" y="30" width="6" height="1" fill="#C0C0C0" />

            <!-- Row 12 - bottom -->
            <rect x="6" y="31" width="4" height="1" fill="#C0C0C0" />

            <!-- Mirror tiles pattern for spherical effect -->
            <!-- Row 1 tiles -->
            <rect x="7" y="20" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="20" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 2 tiles -->
            <rect x="6" y="21" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="21" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="21" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 3 tiles -->
            <rect x="5" y="22" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="22" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="22" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="22" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 4 tiles -->
            <rect x="4" y="23" width="1" height="1" fill="#E0E0E0" />
            <rect x="6" y="23" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="23" width="1" height="1" fill="#E0E0E0" />
            <rect x="10" y="23" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="23" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 5 tiles -->
            <rect x="4" y="24" width="1" height="1" fill="#FFFFFF" />
            <rect x="5" y="24" width="1" height="1" fill="#E0E0E0" />
            <rect x="7" y="24" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="24" width="1" height="1" fill="#E0E0E0" />
            <rect x="11" y="24" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 6 tiles (widest) -->
            <rect x="3" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="4" y="25" width="1" height="1" fill="#FFFFFF" />
            <rect x="6" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="25" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="25" width="1" height="1" fill="#E0E0E0" />
            <rect x="12" y="25" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 7 tiles (widest) -->
            <rect x="2" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="3" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="5" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="26" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="26" width="1" height="1" fill="#E0E0E0" />
            <rect x="13" y="26" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 8 tiles -->
            <rect x="4" y="27" width="1" height="1" fill="#FFFFFF" />
            <rect x="5" y="27" width="1" height="1" fill="#E0E0E0" />
            <rect x="7" y="27" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="27" width="1" height="1" fill="#E0E0E0" />
            <rect x="11" y="27" width="1" height="1" fill="#FFFFFF" />

            <!-- Row 9 tiles -->
            <rect x="4" y="28" width="1" height="1" fill="#E0E0E0" />
            <rect x="6" y="28" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="28" width="1" height="1" fill="#E0E0E0" />
            <rect x="10" y="28" width="1" height="1" fill="#FFFFFF" />
            <rect x="11" y="28" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 10 tiles -->
            <rect x="5" y="29" width="1" height="1" fill="#FFFFFF" />
            <rect x="7" y="29" width="1" height="1" fill="#E0E0E0" />
            <rect x="9" y="29" width="1" height="1" fill="#FFFFFF" />
            <rect x="10" y="29" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 11 tiles -->
            <rect x="6" y="30" width="1" height="1" fill="#E0E0E0" />
            <rect x="8" y="30" width="1" height="1" fill="#FFFFFF" />
            <rect x="9" y="30" width="1" height="1" fill="#E0E0E0" />

            <!-- Row 12 tiles -->
            <rect x="7" y="31" width="1" height="1" fill="#FFFFFF" />
            <rect x="8" y="31" width="1" height="1" fill="#E0E0E0" />

            <!-- Sparkles around the ball -->
            <g className="sparkle sparkle-1">
              <rect x="0" y="24" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-2">
              <rect x="15" y="25" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-3">
              <rect x="1" y="30" width="1" height="1" fill="#FFFF00" />
            </g>
            <g className="sparkle sparkle-4">
              <rect x="14" y="28" width="1" height="1" fill="#FFFF00" />
            </g>
          </svg>
        `;
      };

      // Pixelated Llama SVG Component
      const PixelatedLlama = ({ isDancing }) => {
        return html`
          <svg
            width="160"
            height="160"
            viewBox="0 0 16 16"
            className=${`pixelated ${isDancing ? "dancing" : ""}`}
            style=${{ imageRendering: "pixelated", overflow: "visible" }}
          >
            <!-- Llama body -->
            <rect x="4" y="8" width="8" height="6" fill="#FF8C00" />

            <!-- Llama neck -->
            <rect x="9" y="5" width="3" height="4" fill="#FF8C00" />

            <!-- Llama head -->
            <rect x="9" y="2" width="4" height="3" fill="#FF8C00" />

            <!-- Ears -->
            <rect x="10" y="1" width="1" height="1" fill="#FF8C00" />
            <rect x="12" y="1" width="1" height="1" fill="#FF8C00" />

            <!-- Legs -->
            <rect
              x="5"
              y="14"
              width="2"
              height="2"
              fill="#FF8C00"
              class=${isDancing ? "dancing-feet-left" : ""}
            />
            <rect
              x="9"
              y="14"
              width="2"
              height="2"
              fill="#FF8C00"
              class=${isDancing ? "dancing-feet-right" : ""}
            />

            <!-- Eye -->
            <rect x="11" y="3" width="1" height="1" fill="#000" />

            <!-- Tail -->
            <rect x="3" y="9" width="1" height="2" fill="#FF8C00" />

            <!-- Deal with it sunglasses -->
            ${isDancing &&
            html`
              <g className="sunglasses">
                <!-- Sunglasses frame (thicker, more pixelated) -->
                <rect x="9" y="3" width="5" height="1" fill="#000" />
                <!-- Bridge -->
                <rect x="11" y="2" width="1" height="1" fill="#000" />
                <!-- Left lens frame -->
                <rect x="9" y="2" width="2" height="1" fill="#000" />
                <rect x="9" y="4" width="2" height="1" fill="#000" />
                <rect x="8" y="3" width="1" height="1" fill="#000" />
                <!-- Right lens frame -->
                <rect x="12" y="2" width="2" height="1" fill="#000" />
                <rect x="12" y="4" width="2" height="1" fill="#000" />
                <rect x="14" y="3" width="1" height="1" fill="#000" />
                <!-- Left lens (black) -->
                <rect x="9" y="3" width="2" height="1" fill="#000" />
                <!-- Right lens (black) -->
                <rect x="12" y="3" width="2" height="1" fill="#000" />

                <!-- Pixelated glare effect - stays within lens boundaries -->
                <g className="glare">
                  <!-- Glare pixels that move across the lenses -->
                  <!-- Right lens glare (x:12-13, y:3) -->
                  <rect
                    x="13"
                    y="3"
                    width="1"
                    height="1"
                    fill="#666"
                    opacity="0.8"
                  />
                  <!-- Left lens glare (x:9-10, y:3) -->
                  <rect
                    x="10"
                    y="3"
                    width="1"
                    height="1"
                    fill="#666"
                    opacity="0.8"
                  />
                </g>
              </g>
            `}
          </svg>
        `;
      };

      // YouTube player variable
      let player;
      let playerReady = false;

      // This function will be called by YouTube API when it's ready
      window.onYouTubeIframeAPIReady = function () {
        player = new YT.Player("youtube-player", {
          height: "1",
          width: "1",
          videoId: "eklqLkyoJWA",
          playerVars: {
            autoplay: 0,
            controls: 0,
            disablekb: 1,
            fs: 0,
            loop: 1,
            playlist: "eklqLkyoJWA", // Required for loop to work
            modestbranding: 1,
            playsinline: 1,
          },
          events: {
            onReady: function (event) {
              playerReady = true;
              event.target.setVolume(50);
            },
            onStateChange: function (event) {
              // Restart video when it ends (backup for loop)
              if (event.data === YT.PlayerState.ENDED) {
                player.playVideo();
              }
            },
          },
        });
      };

      const App = () => {
        const [isDancing, setIsDancing] = useState(false);

        const handleDanceClick = () => {
          setIsDancing(!isDancing);

          // Control YouTube player based on dancing state
          if (!isDancing && playerReady && player) {
            player.playVideo();
          } else if (playerReady && player) {
            player.pauseVideo();
          }
        };

        return html`
          <div
            className="w-96 h-96 bg-gradient-to-br from-purple-900 to-pink-500 rounded-lg flex flex-col items-center justify-center shadow-2xl overflow-visible relative"
          >
            ${isDancing && html`<${PixelatedDiscoBall} />`}
            <${PixelatedLlama} isDancing=${isDancing} />
            <button
              onClick=${handleDanceClick}
              className="mt-8 px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-md transition-colors duration-200 shadow-lg"
            >
              ${isDancing ? "OK, stop" : "Deal with it"}
            </button>
          </div>
        `;
      };

      render(html`<${App} />`, document.getElementById("app"));
    </script>
  </body>
</html>
